classDiagram
    class TreeData {
        +Settings settings
        +str user_prompt
        +list conversation_history
        +Environment environment
        +list tasks_completed
        +int num_trees_completed
        +int recursion_limit
        +Atlas atlas
        +CollectionData collection_data
        +list collection_names
        +dict errors
        +str current_task
    }
    
    class Environment {
        +dict environment
        +dict hidden_environment
        +bool self_info
        
        +is_empty() bool
        +add(tool_name, result, include_duplicates) None
        +add_objects(tool_name, name, objects, metadata, include_duplicates) None
        +remove(tool_name, name, index) None
        +replace(tool_name, name, objects, metadata, index) None
        +find(tool_name, name, index) list or dict or None
        +to_json(remove_unserialisable) dict
        +from_json(json_data) Environment$
    }
    
    class Atlas {
        +str style
        +str agent_description
        +str end_goal
        +dict datetime_reference
    }
    
    class CollectionData {
        +list collection_names
        +dict metadata
        +Logger logger
        +list removed_collections
        +list incorrect_collections
        
        +async set_collection_names(collection_names, client_manager) list
        +output_full_metadata(collection_names, with_mappings) dict
        +output_collection_summaries(collection_names) dict
        +output_mapping_lists() dict
        +output_mappings() dict
        +to_json() dict
        +from_json(json_data, logger) CollectionData$
    }
    
    TreeData "1" *-- "1" Environment : contains
    TreeData "1" *-- "1" Atlas : contains
    TreeData "1" *-- "1" CollectionData : contains
    
    note for Environment "Structure:\n{\n  'tool_name': {\n    'result_name': [\n      {\n        'metadata': dict,\n        'objects': list[dict]\n      }\n    ]\n  }\n}"
    
    note for Environment "Two storage areas:\n1. environment: Visible to LLM\n2. hidden_environment: Not shown to LLM\n\nIncludes SelfInfo by default"
    
    class EnvironmentDetails {
        <<structure>>
        tool_name dict
        └── result_name list
            └── entry dict
                ├── metadata dict
                └── objects list~dict~
                    └── object dict
                        ├── property values
                        └── _REF_ID unique_id
    }
    
    class AtlasDetails {
        <<configuration>>
        style string
        └── Writing tone and style
        agent_description string
        └── Process description
        end_goal string
        └── Overall objective
        datetime_reference dict
        └── Current date/time context
    }
    
    class CollectionMetadataStructure {
        <<metadata>>
        fields list
        └── field dict
            ├── description str
            ├── range list~float~
            ├── type str
            ├── groups dict
            └── mean float
        mappings dict
        └── mapping_name dict
            └── frontend_field→data_field
        length float
        summary str
        name str
        named_vectors list
        └── vector dict
            ├── name str
            ├── enabled bool
            ├── source_properties list
            └── description str
        index_properties dict
        └── isNullIndexed, isLengthIndexed, isTimestampIndexed
    }
    
    Environment -- EnvironmentDetails : structure
    Atlas -- AtlasDetails : configuration
    CollectionData -- CollectionMetadataStructure : metadata
    
    class TasksCompletedStructure {
        <<tracking>>
        prompt str
        └── task list
            └── task_entry dict
                ├── task str
                ├── iteration int
                ├── reasoning str
                ├── inputs dict
                ├── parsed_info str
                ├── action bool
                └── error bool
    }
    
    TreeData -- TasksCompletedStructure : tracks
    
    note for EnvironmentDetails "_REF_ID provides unique\nidentification for objects\nDuplicates marked with\noriginal _REF_ID"
    
    note for CollectionMetadataStructure "Generated by preprocess()\nStored in ELYSIA_METADATA__\nProvides full data awareness"
    
    note for TasksCompletedStructure "LLM-visible task log\nShows reasoning chain\nUsed for context in prompts"

